\section{Hastighetsregulator}\label{sec:hastighetsreg}

\subsection{Teori}

Regulatorer brukes for å styre tilstander i en prosess. En regulator regulator får inn et avvik mellom referansen og den målte tilstanden. Regulatorer bruker avviket til å beregne et pådrag til prosessen. P-regulator er en type regulator som lager et pådrag, $u$,  som er proposjonalt med avviket, $e = \omega_d - \omega_m$. $K_p$ er proposjonalitetsleddet i regulatoren, sammenhengen er vist i \autoref{eq:P_regulator}.

\begin{equation}
    \label{eq:P_regulator}
    u(t) = K_p e(t)
\end{equation}

En slik regulator er effektiv så lenge det ikke er en kraft som forhindrer systemet å oppnå en spesifikk tilstand. I et slikt tilfelle vil ikke regulatoren regulere tilstanden til referanseverdien og det til oppstå et stasjonærtavvik. Et integratorledd vil forhindre stasjonærtavvik ved å gi et pådrag som er likt den kraften som forhindrer at systemet når referanse tilstanden. \autoref{eq:PI_regulator} beskriver en PI-regulator,

\begin{equation}
    \label{eq:PI_regulator}
    u(t) = K_p e(t) + \frac{K_p}{T_i} \int_{0}^{t} e(\tau) d\tau
\end{equation}

der $u$ er pådraget, $K_p$ er proposjonalitetskontanten, $e$ er avviket mellom referansen og tilstanden og $T_i$ er integratorkonstanten som representerer tidskonstanten til regulatoren.

\subsection{Metode}

\begin{figure}[b]
    \centering
    \input{figurer/krets_hastighets_regulator.tex}
    \caption{PI-regulator krets for hastighetsregulatoren. Hentet fra \cite{AnalogMotorlabbOppgaver}}
    \label{fig:krets_hastighets_regulator}
\end{figure}

Hastighetsregulatoren ble implementert som en analog PI-regulator som vist i \autoref{fig:krets_hastighets_regulator}. $OP1$ er en differensialforsterker som finner avviket, $e$, transferfunksjonen er gitt ved \autoref{eq:differensialforsterker}.
$OP2$ er en inverterende forsterker som inverterer avviket, uten forsterkning eller demping.
$OP3$ er en integrerende forsterker som integrerer $e$ og forsterker den med $\frac{1}{T_i}$. $JP1$ brukes for å nullstille integratoren og skru av I-leddet i integratoren. Da vil regulatoren oppføre seg som en P-regulator. Transferfunksjonen til $OP3$ er $-\frac{1}{(R_5 + R_6) C_1} \int e dt$. Dersom $JP1$ er kortsluttet er speningen ut fra $OP3$ alltid $0\,V$
$OP4$ summerer spenningen fra $OP2$ og $OP3$ og forsterker resultatet med $K_p$. Transferfunksjonen for $OP4$ er $-\frac{R_8 + R_9}{R_7}(v_2 + v_3)$, der $v_2$ er spenningen ut av $OP2$ og $v_3$ er spenningen ut av $OP3$. Ut fra dette finner vi uttrykk for $K_p$ og $T_i$ som vist i \autoref{eq:K_p_og_T_i}.

\begin{equation}
    \label{eq:K_p_og_T_i}
    K_p = \frac{R_2}{R_1} \frac{R_8 + R_9}{R_7},
    T_i = (R_5 + R_6) C_1
\end{equation}

Størrelsen på motstandene og kondensatoren er vist i \autoref{tab:Komponenter_i_hastighetsregulatoren}

\begin{table}
    \centering
    \caption{Motstander og kondensatorer i hastighetsregulatoren. Verdiene er hentet fra \cite{AnalogMotorlabbOppgaver}}
    \begin{tabular}{lll}
        \toprule
        Størrelse & Verdi & Type \\
		\midrule
        $R_1$, $R_2$ & 100\,\kilo\ohm & Resistor\\
        $R_3$, $R_4$, $R_7$, $R_8$ & $10\,k\Omega$ & Resistor \\
        $R_5$, $R_9$ & $1\,M\Omega$ & Potmeter \\
        $R_6$ & $1\,k\Omega$ & Resistor \\
        $C_1$ & $1\,\mu F$ & Kondensator \\
        \bottomrule
    \end{tabular}
    \label{tab:Komponenter_i_hastighetsregulatoren}
\end{table}

\subsection{Resultater}

\todo[inline]{Burde det være noe tekst her?}

\begin{figure}[h!]
    \centering
    \input{figurer/plots/hastighet_P_regulator}
    \caption{Sprangresponsen til P-hastighetsregulatoren. Data er hentet fra \cite{EksempelData}}
    \label{fig:hastighet_P_regulator}
\end{figure}

\begin{figure}[h!]
    \centering
    \input{figurer/plots/hastighet_PI_regulator}
    \caption{Sprangresponsen til PI-hastighetsregulatoren. Data er hentet fra \cite{EksempelData}}
    \label{fig:hastighet_PI_regulator}
\end{figure}

\subsection{Diskusjon}

I \autoref{fig:hastighet_P_regulator} er det et tydelig stasjonæravvik, mellom responen til regulatoren og referanseverdien. Det er flere årsaker til at stasjonværavviket oppstå, blant annet friksjon i motoren, giret, og potmeteret. Dersom motoren bremses, vil det stasjonæreavviket øke, til tross for at pådraget også vil øke.
Til tross for at det er et stasjonæravvik er det ikke så stort. Dette kommer antageligvis av at $K_p$ er et stort tall. Dersom vi ser på 

PI-regulatoren oppnår stasjonærverdi, som vist i \autoref{fig:hastighet_PI_regulator}. Legg merke til