\section{Posisjonsmåler}
\label{sec:pos_måler}

\subsection{Teori}

% Enpolet målesignal
%   - Referanse til signaljord
% Signalkilde -[signal]-> signalmottaker / last
% Målevariabel -> Føler -> Omsetter -> Målesignal

% Standardiserte signalnivåer
% 1 - 5V
% Elevated Zero
%   - Muliggjør deteksjon av feil
%   - Vanskelig å måle 0, krever negativ strømforsyning
%   - Ledningsbrud
%   - Muliggjør alarmgrenser utenfor ordinært måleområde

Posisjonsmåling kan enten være en vinkelmåling eller en strekningsmåling. For en servomotor er målevariabelen vinkel nyttigst. Potensiometer kan brukes som en føler for måleveraibelen. Med en spennig over potensiometeret, vil dette generere et enpolet målesignal, med en spenningsforskjell til jord.

For å lettere detektere feil er standardiserte målesignaler med elevated zero nyttig. Ledningsbrudd blir da lettere å oppdage. I tillegg er det vanskelig å måle spenninger rundt $0V$, med laveste signal over $0V$ vil ikke dette bli et problem. Derfor er det lurt å omformere målesignalet til et standardisert målesignal.

\subsection{Metode}

\begin{figure}[h]
    \centering
    \input{figurer/krets_posisjon_potmeter}
    \caption{Potensiometeret i motorkortet. Figur hentet fra \cite{AnalogMotorlabbOppgaver}}
    \label{fig:posisjon_maler_potmeter}
\end{figure}

\begin{table}[h]
    \centering
    \caption{Motstander og kondensatorer i posisjonomformer. Verdiene er hentet fra \cite{AnalogMotorlabbOppgaver}}
    \begin{tabular}{lll}
        \toprule
        Størrelse & Verdi & Type \\
		\midrule
        $R_1$ & $1\,k\Omega$ & Resistor\\
        $R_2$ & $6,8\,k\Omega$ & Resistor \\
        $R_3$ & $100\,k\Omega$ & Potmeter \\
        $R_4$ & $10\,k\Omega$ & Potmeter \\
        \bottomrule
    \end{tabular}
    \label{tab:Komponenter_i_posisjonsmaler}
\end{table}

I motorkortet er et potensiometer koblet til motorakslingen. Den er koblet i serie med to motstander, som vist i \autoref{fig:posisjon_maler_potmeter}. Spenningsdeling brukes for å kommefram til følgende uttryk for $V(\theta)$

\begin{equation}
    \label{eq:V_av_theta}
    V(\theta) = \frac{\SI{5}{\kilo\ohm} + R(\theta)}{\SI{12}{\kilo\ohm} + \SI{5}{\kilo\ohm} + \SI{8.2}{\kilo\ohm}} \SI{30}{\volt} - \SI{15}{\volt},
\end{equation}

der $V(\theta)$ er spenningen ut fra motorkortet, $R(\theta)$ er motstaden i potensiometeret gitt vinkelen til motoren. Det betyr at $V(\theta_{min}) = \SI{0.71428}{\volt}$ og $V(\theta_{max}) =\SI{-5.23809}{\volt}$. 

\begin{figure}[h]
    \centering
    \input{figurer/krets_posisjons_maler}
    \caption{Krets for å omforme spenningen fra posisjonsmåleren til et $1\,V$ til $5\,V$ signal. Figur hentet fra \cite{AnalogMotorlabbOppgaver}}
    \label{fig:krets_posisjons_maler}
\end{figure}

Transferfunksjonen i \autoref{fig:krets_posisjons_maler} kan deles opp i to deler. De to første operasjonsforsterkerne, $OP1$ og $OP2$, har denne transferfunksjonen $V_x = -V(\theta)$. Ved bruk av opampens gyldne regler og Kirkhoffs strømlov blir strømmen gjennom $R_2$ lik strømmen gjennom $R_4$. Dette fører til følgende sammenheng
\begin{equation}
    \label{eq:posisjonmåler_skalering}
    (V_x - V_y) \frac{1}{R_2} = (V_y - V_{\theta_m}(\theta)) \frac{1}{R_4},
\end{equation}
der $V_x$, $V_y$ og $V_{\theta_m}$ er potensialet i punktene navngitt i \autoref{fig:krets_posisjons_maler} og $R_2$ og $R_4$ er motstandene i same figur.

For å finne $R_3$ og $R_4$ må vi løse for $V_y$ og $R_4$. Da bruker vi sammenhengene $V_{\theta_m}(\theta_{min}) = \SI{1}{\volt}$ og $V_{\theta_m}(\theta_{max}) = \SI{5}{\volt}$. Da blir $R_4 = \SI{4.6}{\kilo\ohm}$ og 
$V_y = \SI{2.7}{\volt}$. Sammenhengen mellom $R_3$ og $V_y$ er gitt ved $\frac{R_3}{\SI{100}{\kilo\ohm}} \SI{30}{\volt} = V_y + \SI{15}{\volt}$, da blir $R_3 = \SI{59}{\kilo\ohm}$. Etter at $R_3$ og $R_4$ ble satt til de utregnede verdiene ble de også finjustert manuelt.

Transferfunksjonen for kretsen den totale kretsen blir
\begin{equation}
    \label{eq:posisjon_maling_transferfuksjon}
    V_{\theta_m}(\theta) = V_y + \frac{R_4}{R_2}(V_y + V(\theta)).
\end{equation}

\subsection{Resultater}

\begin{figure}[h]
    \centering
    \input{figurer/plots/posisjon_sagtann}
    \caption{Spenningen ut av posisjonsmåleren der rotasjonshastigheten er konstant.}
    \label{fig:posisjon_sagtann}
\end{figure}

\label{obs:floating_potensiometer}
Det ble observert at ved å stille inn retningen til motoren mellom $\theta_{max}$ og $\theta_{min}$ fikk vi en måling på omtrent \SI{4.4}{\volt}.

\subsection{Diskusjon}

Målingen i \autoref{fig:posisjon_sagtann} er omtrent i intervallet (\SI{1}{\volt}, \SI{5}{\volt}). Årsaken til at grafen ser ut som en sagtannbølge er at potensiometeret roterer rundt og motstanden i potensiometeret syker gradvis, til den har rotert en runde og da er den på maksimum motstand.

Ovservasjonen i \ref{obs:floating_potensiometer} kommer nok av at slepekontakten i potensiometeret ikke er koblet til noen av polene. Denne flytende pinnen inn i posisjonsmåleren tilsvarer spenningen vi forventer dersom vi putter inn setter $V(\theta) = \SI{0}{\volt}$ i uttrykk \eqref{eq:posisjon_maling_transferfuksjon}. Den forventede spenningen blir da \SI{4.5}{\volt}.