\section{Posisjonsregulator}\label{sec:posisjonsregulator}

\subsection{Teori}

% Reguleringoversving
% Kaskaderegulator
% P-regulator
% Zenerdiode

En zenerdiode er en halvlederdiode som lar strøm gå både med og mot diodens sperreretning. Dioden er laget slik at den tillater strøm å gå i sperreretning etter at en viss spenning blir satt over den, det vil si at zenerdioden kun leder strøm i sperreretningen etter at den når sperrespenningen (zenerspenning), og dermed opprettholder dioden zenerspenningen over seg i sperreretning om en høyere spennning er satt over den.
\todo[inline]{avsnittet over må fikses, for trøtt til å gjøre det nå}

Regulatoren vil bli implementert som en P-regulator, med uttrykk som i \eqref{eq:P_regulator}. Pådraget fra posisjonsregulatoren vil gå inn i hastighetsregulatoren og systemet blir da kaskaderegulert.
\todo[inline]{er dette mer metode?}








\subsection{Metode}

\begin{figure} [h]
    \centering
    \input {figurer/Posisjonsregulator.tex}
    \caption{Differensiell operasjonsforsterker. Figur hentet fra \cite{AnalogMotorlabbOppgaver}}
    \label{fig:Posisjonsregulator}
\end{figure}

\begin{table}[h]
    \centering
    \caption{Komponenter i posisjonsregulatoren. Verdiene er hentet fra \cite{AnalogMotorlabbOppgaver}}
    \begin{tabular}{lll}
        \toprule
		Størrelse & Verdi & Type \\
		\midrule
        $R_2$ & \SI{560}{\ohm} & Resistor \\
        $R_3$ & \SI{1.5}{\kilo\ohm} & Resistor\\
        $R_4$ & \SI{10}{\kilo\ohm} & Potmeter\\
        $R_5$ & \SI{5.6}{\kilo\ohm} & Resistor\\
        $R_6, R_7$ & \SI{100}{\kilo\ohm} & Resistor\\
        $R_8$ & \SI{27}{\kilo\ohm} & Resistor\\
        $R_9$ & \SI{10}{\mega\ohm} & Potmeter\\
        $D_1$ & \SI{5.1}{\volt} & Zenerdiode\\
        $C_1$ & \SI{100}{\nano\farad} & Kondensator\\
		\bottomrule
    \end{tabular}
    \label{tab:my_label}
\end{table}

Som siste del av prosjektet ble posisjonsregulatoren implementert. Kretsen er vist i \autoref{fig:Posisjonsregulator}. Posisjonsregulatoren er satt sammen av en krets for å gi en posisjonsreferanse $\theta_d$ og regulatoren selv.
Posisjonsreferansekretsen benytter en zenerdiode for å opprettholde en konstant referansespenning på {\SI{5.1}{\volt}} til en spenningsdeling over $R_3$, $R_4$ og $R_5$. Kondensatoren $C_1$, vil hjelpe til med å holde en jevnere spenning, og fjerne støy inn til spenningsdelingen. Posisjonsreferansen $\theta_d$ kunne dermed justeres ved å endre på potensiometeret $R_4$. Denne referansen ble så sendt inn i selve regulatoren. Ved bruk av spenningsdeling blir $\theta_d = \frac{x R_4 + R_5}{R_3 + R_4 + R_5} D1$, der $x$ er et tall fra 0 til 1, etter hvilken posisjon $R_4$ er i og $D1$ er spenningen over dioden. Intervallet til $R_4$ blir (\SI{1.7}{\volt}, \SI{4.7}{\volt}). Siden dette intervallet er litt mindre enn intervallet til $\theta_m$ vil små reguleringsoversving over eller under referansen ikke føre til at slepekontakten går over $\theta_{max}$ eller under $\theta_{min}$, slik at servomotoren ikke begynner å rotere hele runder.

Regulatoren ble implementert som vist i høyre del av \autoref{fig:Posisjonsregulator}. Første operasjonforsterker sammenligner posisjonsreferansen $\theta_m$ og den målte posisjonen fra posisjonsmåleren $\theta_d$, slik at avviket blir $e_{\theta} = \theta_d - \theta_m$. Den andre operasjonforsterkeren forsterker signalet med en forsterkning justert av potensiometeret $R_9$. Ut av posisjonsregulatoren sendes $\omega_d$ til hastighetsregulatoren som referanse.
Etter at systemet var finjustert riktig ved bruk av de forskjelle potensiometerene, ble en signalgenerator koblet til $\theta_d$ i stedet for referansekretsen. Med signalgeneratoren kunne systemets frekvensrespons testes.







\subsection{Resultater}
\todo[inline]{sørge for at alle resultatgrafer ligger under resultater}

\begin{figure}[h]
    \centering
    \input{figurer/plots/posisjon_P_regulator}
    \caption{Sprangresponsen til posisjonsregulatoren. Data hentet fra \cite{EksempelData}}
    \label{fig:posisjon_P_regulator}
\end{figure}

\begin{figure}[h]
    \centering
    \input{figurer/plots/bode2}
    \caption{Bodeplot for posisjonsregulatoren}
    \label{fig:bodeplot}
\end{figure}










\subsection{Diskusjon}

\autoref{fig:posisjon_P_regulator} viser at regulatoren når referanseverdien uten stasjonæravvik. Det er verdt å legge merke til en spike i starten av transienten. Det kan være flere årsaker for at denne oppstår, deriblant induksjon fra pådragstrømmen til målestrømmen. Det er også et lite oversving i posisjonsregulatoren, til tross for at posisjonsregulatoren er av første orden. Dette kan skje siden hele systemet har en kaskaderegulator av høyere orden.

Bode-plottet i \autoref{fig:bodeplot} har et knekkpunkt omtrent ved \SI{0.8}{\hertz}. Det betyr at motoren klarer å følge referansen inntil frekvensen blir større enn \SI{0.8}{\hertz}. Deretter rekker ikke motoren å peke i riktig retning før den må bytte retning. Det gjør at den ikke oscillerer over hele området til referansen.

\todo[inline]{
Verdier for $K_p$ og de andre reguleringsparameterene??
}



































% Dersom dere ønsker å tegne kretsskjema med Tikz, finner dere et eksempel i filen
% \texttt{kretsskjema.tex} under \texttt{figurer}. Resultatet kan dere se i 
% Figur \ref{fig:kretsskjema}. Det er ikke nødvendig å bruke tikz for å tegne kretsskjema, dere kan også bruke andre (mer brukervennlige) programmer. Pass på at 
% det er lett å lese kretsskjemaet når dere har satt det inn i rapporten deres!

% \begin{figure}[t]
%     \centering
%     \input{figurer/kretsskjema.tex}
%     \caption{Eksempel på kretsskjema fra Eksamen i TTK4101 2021.}
%     \label{fig:kretsskjema}
% \end{figure}

% Dersom dere eksporterer plots som eps, bruker vi kommandoen \texttt{includegraphics}
% for å tegne figuren, som vist i kildekoden. Resultatet er vist i Figur 
% \ref{fig:eps_eksempel}.

% \begin{figure}[t]
% \centering
% \includegraphics[width=0.4\textwidth]{figurer/eksempel_plott.eps}
% \caption{Eksempel på plott med eps-fil. Merk at fontstørrelsen er mindre enn i
% resten av dokumentet, ettersom den er styrt av figurstørrelsen når vi laget plottet.}
% \label{fig:eps_eksempel}
% \end{figure}

% Dersom dere eksporterer figurene deres som tikz, bruker vi kommandoen \texttt{\\input}
% for å vise figuren. Resultatet er vist i Figur \ref{fig:tikz_eksempel}.
% \setlength{\figW}{0.4\textwidth}
% \setlength{\figH}{0.35\textwidth}
% \begin{figure}[t]
%     \centering
%     \input{figurer/eksempel_plott.tex}
%     \caption{Eksempel på plott med tikz-kode. Merk at fontstørrelsen er lik resten av dokumentet, ettersom den er styrt av Latex-kompilatoren.}
%     \label{fig:tikz_eksempel}
% \end{figure}

